"use strict";(self.webpackChunkbee_docs=self.webpackChunkbee_docs||[]).push([[5040],{67100:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=t(17624),s=t(4552);const r={title:"Security",id:"security"},o=void 0,a={id:"bee/working-with-bee/security",title:"Security",description:"The restricted APIs feature is experimental, further breaking changes might be introduced in the upcoming releases",source:"@site/docs/bee/working-with-bee/security.md",sourceDirName:"bee/working-with-bee",slug:"/bee/working-with-bee/security",permalink:"/docs/bee/working-with-bee/security",draft:!1,unlisted:!1,editUrl:"https://github.com/ethersphere/docs.github.io/blob/master/docs/bee/working-with-bee/security.md",tags:[],version:"current",frontMatter:{title:"Security",id:"security"},sidebar:"bee",previous:{title:"Swarm CLI",permalink:"/docs/bee/working-with-bee/swarm-cli"},next:{title:"Staking",permalink:"/docs/bee/working-with-bee/staking"}},d={},c=[{value:"Calling the restricted APIs",id:"calling-the-restricted-apis",level:2},{value:"Getting the security token",id:"getting-the-security-token",level:3},{value:"Example",id:"example",level:4},{value:"Refreshing the security token",id:"refreshing-the-security-token",level:3},{value:"A note on the HTTP endpoints",id:"a-note-on-the-http-endpoints",level:3},{value:"Technical debug endpoints:",id:"technical-debug-endpoints",level:4},{value:"Business related endpoints residing on the debug port",id:"business-related-endpoints-residing-on-the-debug-port",level:4},{value:"API endpoints",id:"api-endpoints",level:4},{value:"The order in which HTTP endpoints become available",id:"the-order-in-which-http-endpoints-become-available",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"The restricted APIs feature is experimental, further breaking changes might be introduced in the upcoming releases"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Only a subset of endpoints running on ",(0,i.jsx)(n.code,{children:":1633"})," can be restricted. This is subject to change in the future releases."]})}),"\n",(0,i.jsx)(n.p,{children:"Now that you decided to restrict the access to the APIs you should follow the next steps:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pick a password that is strong enough."}),"\n",(0,i.jsxs)(n.li,{children:["Use a bcrypt utility to hash it (you can use ",(0,i.jsx)(n.code,{children:"bee bcrypt"})," command for this purpose ",(0,i.jsx)(n.a,{href:"/docs/bee/working-with-bee/bcrypt",children:"bcrypt utility"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Pass the hash to the bee instance using the ",(0,i.jsx)(n.code,{children:"--admin-password"})," command line option (or as a configuration parameter)"]}),"\n",(0,i.jsxs)(n.li,{children:["Pick a random string to be used for the ",(0,i.jsx)(n.code,{children:"--token-encryption-key"})," (the same security token can be used against many instances sharing the same encryption key)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"calling-the-restricted-apis",children:"Calling the restricted APIs"}),"\n",(0,i.jsx)(n.h3,{id:"getting-the-security-token",children:"Getting the security token"}),"\n",(0,i.jsxs)(n.p,{children:['In order to call any of the restricted APIs the requests have to have a "Bearer" ',(0,i.jsx)(n.code,{children:"Authorization"})," header with a valid security token. The security token can be acquired by calling the ",(0,i.jsx)(n.code,{children:"/auth"})," HTTP endpoint that is protected using ",(0,i.jsx)(n.a,{href:"https://www.w3.org/Protocols/HTTP/1.0/spec.html#BasicAA",children:"basic authentication"})]}),"\n",(0,i.jsxs)(n.p,{children:["To call this endpoint you need to generate an authorization header based on our password. That is achieved by ",(0,i.jsx)(n.code,{children:"base64"})," encoding our password ",(0,i.jsx)(n.em,{children:"prepended"}),' with a colon ":" character (since username is empty in our case). So if our password is ',(0,i.jsx)(n.code,{children:"s3cret"})," then you need to ",(0,i.jsx)(n.code,{children:"base64(:s3cret)"})]}),"\n",(0,i.jsx)(n.p,{children:"The payload is in a json format containing two fields:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"role"}),"\n",(0,i.jsx)(n.li,{children:"expiry"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"role"})," field can have one of the four values:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"maintainer"}),"\n",(0,i.jsx)(n.li,{children:"creator"}),"\n",(0,i.jsx)(n.li,{children:"auditor"}),"\n",(0,i.jsx)(n.li,{children:"consumer"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"expiry"})," field is a numeric value representing the lifetime of the token (in seconds)"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"There is an inheritance relationship between roles: consumer \u2286 creator \u2286 accountant \u2286 maintainer\nMaintainer role is universal - it's the superset of all permissions belonging to other roles."})}),"\n",(0,i.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(n.p,{children:["Let's say our password is ",(0,i.jsx)(n.code,{children:"hello"})]}),"\n",(0,i.jsxs)(n.p,{children:["By base64 encoding ",(0,i.jsx)(n.code,{children:":hello"})," we get the value ",(0,i.jsx)(n.code,{children:"OmhlbGxv"})]}),"\n",(0,i.jsx)(n.p,{children:"this is our basic authorization header value that we can use in our payload:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST {{api}}/auth\nContent-Type: application/json\nAuthorization: Basic OmhlbGxv\n\n{\n    "role": "maintainer",\n    "expiry": 3600\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Sample response:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "key":"A1UQrbNUK22otp50EsESoJNYkJfrK9H1D4ex4gSWUddx3H/A9VCu8ltS8lVmvSTzoNA=="\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"refreshing-the-security-token",children:"Refreshing the security token"}),"\n",(0,i.jsxs)(n.p,{children:["In order to refresh the token we need to call the ",(0,i.jsx)(n.code,{children:"/refresh"})," endpoint in the same manner as when we are calling any other restricted API endpoint - by putting valid existing token in the http request:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST {{api}}/refresh\nContent-Type: application/json\nAuthorization: Bearer A1UQrbNUK22otp50EsESoJNYkJfrK9H1D4ex4gSWUddx3H/A9VCu8ltS8lVmvSTzoNA==\n\n{\n    "role": "maintainer",\n    "expiry": 86400\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"In the payload you can specify a different role and token lifetime."}),"\n",(0,i.jsx)(n.h3,{id:"a-note-on-the-http-endpoints",children:"A note on the HTTP endpoints"}),"\n",(0,i.jsx)(n.p,{children:"There are three major groups:"}),"\n",(0,i.jsx)(n.h4,{id:"technical-debug-endpoints",children:"Technical debug endpoints:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"  * /readiness\n  * /node\n  * /addresses\n  * /chainstate\n  * /debug/pprof\n  * /debug/vars\n  * /health\n"})}),"\n",(0,i.jsx)(n.h4,{id:"business-related-endpoints-residing-on-the-debug-port",children:"Business related endpoints residing on the debug port"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"  * /peers\n  * /pingpong/{peer-id}\n  * /reservestate\n  * /connect/{address}\n  * /blocklist\n  * /peers/{address}\n  * /chunks/{address}\n  * /topology\n  * /welcome-message\n  * /balances\n  * /balances/{peer}\n  * /consumed\n  * /consumed/{peer}\n  * /timesettlements\n  * /settlements\n  * /settlements/{peer}\n  * /chequebook/cheque/{peer}\n  * /chequebook/cheque\n  * /chequebook/cashout/{peer}\n  * /chequebook/balance\n  * /chequebook/address\n  * /chequebook/deposit\n  * /chequebook/withdraw\n  * /wallet\n  * /stamps\n  * /stamps/{id}\n  * /stamps/{id}/buckets\n  * /stamps/{amount}/{depth}\n  * /stamps/topup/{id}/{amount}\n  * /stamps/dilute/{id}/{depth}\n  * /batches\n  * /tags/{id}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"api-endpoints",children:"API endpoints"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"  * /bytes\n  * /bytes/{address}\n  * /chunks\n  * /chunks/stream\n  * /chunks/{address}\n  * /soc/{owner}/{id}\n  * /feeds/{owner}/{topic}\n  * /bzz\n  * /bzz/{address}\n  * /bzz/{address}/{path}\n  * /pss/send/{topic}/{targets}\n  * /pss/subscribe/{topic}\n  * /tags\n  * /tags/{id}\n  * /pins\n  * /pins/{reference}\n  * /stewardship/{address}\n  * /auth\n  * /refresh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The user can toggle the debug port by setting the appropriate boolean value on ",(0,i.jsx)(n.code,{children:"debug-api-enable"})," configuration parameter.\nIf the value is ",(0,i.jsx)(n.code,{children:"false"})," (default) then the first two groups of endpoints will not be available."]}),"\n",(0,i.jsxs)(n.p,{children:["Once we toggle the ",(0,i.jsx)(n.code,{children:"restricted"})," flag to ",(0,i.jsx)(n.code,{children:"true"})," - two things are going to happen:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"it will expose the debug business related endpoints on the API port"}),"\n",(0,i.jsx)(n.li,{children:"it will restrict the access to them based on the security configuration provided."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Toggling the restricted flag ON will not remove the business related endpoints from the debug port, nor will it restrict them there."})}),"\n",(0,i.jsx)(n.h3,{id:"the-order-in-which-http-endpoints-become-available",children:"The order in which HTTP endpoints become available"}),"\n",(0,i.jsxs)(n.p,{children:["The technical debug endpoints group will be the first to become available - as soon as its dependencies come online (within seconds).\nThe other two groups will become available at a later stage, specifically after the postage syncing is done.\nRequests to a non technical debug endpoint before it becomes available will be rejected with a ",(0,i.jsx)(n.code,{children:"404"})," http response code."]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},4552:(e,n,t)=>{t.d(n,{I:()=>a,M:()=>o});var i=t(11504);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);